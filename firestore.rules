
/**
 * @file Firebase Security Rules for Northway Application
 * @description This ruleset enforces a user-ownership model for user profiles,
 * and allows public read access to university data, while restricting write access.
 *
 * Data Structure:
 * - /users/{userId}/profile: User profile information, accessible only by the user.
 * - /universities/{universityId}: Publicly readable university data.
 *
 * Key Security Decisions:
 * - User profiles are strictly owned by the authenticated user.
 * - University data is publicly readable, but write access is restricted.
 *
 * Denormalization for Authorization:
 *   No denormalization is used in this simple example.
 *
 * Structural Segregation:
 *   User profiles are stored in a private subcollection, while university data is in a public top-level collection.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Secures user profile data, ensuring only the authenticated user can access their own profile.
     * @path /users/{userId}/profile
     * @allow (get, update, delete) User with ID 'user123' can access /users/user123/profile.
     * @deny (get, update, delete) User with ID 'user456' cannot access /users/user123/profile.
     * @principle Enforces document ownership for all operations on the user profile.
     */
    match /users/{userId}/{document=**} {
      allow read, write: if isSignedIn() && isOwner(userId);
    }

    /**
     * @description Makes university data publicly readable while restricting write access.
     * @path /universities/{universityId}
     * @allow (get, list) Any user (signed in or not) can read university data.
     * @deny (create, update, delete) No one can create, update, or delete university data without proper authorization (not implemented here).
     * @principle Allows public read access but restricts write access to authorized users (not defined).
     */
    match /universities/{universityId} {
      allow get, list: if true;
      allow write: if false;
    }

    // --- Helper Functions ---

    /**
     * @description Checks if the user is signed in.
     * @return True if the user is authenticated, false otherwise.
     */
    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description Checks if the authenticated user ID matches the provided user ID.
     * @param {string} userId The user ID to compare against the authenticated user's ID.
     * @return True if the user IDs match, false otherwise.
     */
    function isOwner(userId) {
      return request.auth.uid == userId;
    }
  }
}
